

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    
        <title>1. CoFI Basic Concepts | CoFI dev</title>
    

    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=62ba249389abaaa9ffc34bf36a076bdc1d65ee18" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/style.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.87249bd3f7b54630a2508c1b61607c7f.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="../_static/inlab_logo_60px.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="2. Linear regression" href="2_cofi_example_linear_reg.html" />
    <link rel="prev" title="Tutorials" href="index.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/cofi-logo-removebg.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">CoFI <span class="project-version">dev</span></h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Welcome to CoFI’s documentation!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Basic usage
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   Tutorials
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     1. CoFI Basic Concepts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="2_cofi_example_linear_reg.html">
     2. Linear regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="3_cofi_example_xrt.html">
     3. X-ray tomography
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="4_cofi_example_rfc.html">
     4. Receiver function
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../getting-started.html">
   Getting started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../faq.html">
   Frequently Asked Questions
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Reference
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../api/index.html">
   List of functions and classes (API)
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/generated/cofi.BaseProblem.html">
     cofi.BaseProblem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/generated/cofi.InversionOptions.html">
     cofi.InversionOptions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/generated/cofi.Inversion.html">
     cofi.Inversion
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/generated/cofi.InversionResult.html">
     cofi.InversionResult
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/generated/cofi.solvers.BaseSolver.html">
     cofi.solvers.BaseSolver
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../changelog.html">
   CHANGE LOG
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Developer notes
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../contribute.html">
   Contribute to CoFI
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/inlab-geo/cofi"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/inlab-geo/cofi/issues/new?title=Issue%20on%20page%20%2Fnotebooks/1_basic_concepts.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/inlab-geo/cofi/edit/main/doc/notebooks/1_basic_concepts.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/notebooks/1_basic_concepts.ipynb.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-an-objective">
   Example: an “objective”
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-a-solver">
   Example: a “solver”
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-using-myownsolver-to-solve-myownobjective">
   Example: using
   <code class="docutils literal notranslate">
    <span class="pre">
     MyOwnSolver
    </span>
   </code>
   to solve
   <code class="docutils literal notranslate">
    <span class="pre">
     MyOwnObjective
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#under-objective-forward">
   Under “objective”: “forward”
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>1. CoFI Basic Concepts</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-an-objective">
   Example: an “objective”
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-a-solver">
   Example: a “solver”
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-using-myownsolver-to-solve-myownobjective">
   Example: using
   <code class="docutils literal notranslate">
    <span class="pre">
     MyOwnSolver
    </span>
   </code>
   to solve
   <code class="docutils literal notranslate">
    <span class="pre">
     MyOwnObjective
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#under-objective-forward">
   Under “objective”: “forward”
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="cofi-basic-concepts">
<h1>1. CoFI Basic Concepts<a class="headerlink" href="#cofi-basic-concepts" title="Permalink to this headline">#</a></h1>
<p>In this tutorial, we get to know the concepts of “objective” and “solver” in the context of CoFI (Common Framework of Inversion).</p>
<p>The core idea of CoFI is to provide a standard way to define both geophysical problems and inverse solvers, so that different problems (from different sources) can be fed into various solvers that implement this interface.</p>
<p>Therefore, knowing how to define problems (we name it “objective”) and solvers is the first step in this tutorial.</p>
<p>The following two blocks are what they look like and what they have:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BaseObjective</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">misfit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BaseSolver</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objective</span><span class="p">):</span>
        <span class="k">pass</span>
    
    <span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
<p>The basic requirement of an “objective” is to provide an evaluation given a model - we call this function “misfit”, so that we want it to be as small as possible.</p>
<p>The basic requirement of a “solver” is to find information about the best-fit model or model distribution. Given a problem description (in form of an “objective” instance), each solver has its own way but all will have the function name “solve” to start the process and return a result.</p>
<p>Note that both of the classes defined above are a part of CoFI package already, so you don’t need to define a “BaseObjective” or “BaseSolver”. Whenever we want to define a new problem, we define a subclass of “BaseObjective”, like how we’ll do it in the next code block below. The same idea applies to “BaseSolver”.</p>
<section id="example-an-objective">
<h2>Example: an “objective”<a class="headerlink" href="#example-an-objective" title="Permalink to this headline">#</a></h2>
<p>Here’s a minimum example! Let’s see how we can define an “objective” if we’d like our solver to calculate the “<span class="math notranslate nohighlight">\(x\)</span>” that minimises “<span class="math notranslate nohighlight">\(x^2-2x+1\)</span>”. So here the value of this function is our “misfit”.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyOwnObjective</span><span class="p">(</span><span class="n">BaseObjective</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">misfit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">model</span> <span class="o">*</span> <span class="n">model</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">model</span> <span class="o">+</span> <span class="mi">1</span>
    
</pre></div>
</div>
</div>
</div>
<p>In practice, we usually use collected data to calculate the misfit. In such cases, you can pass in your dataset through the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> constructor and then use them to calculate the misfit.</p>
</section>
<section id="example-a-solver">
<h2>Example: a “solver”<a class="headerlink" href="#example-a-solver" title="Permalink to this headline">#</a></h2>
<p>Now that we’ve got a well defined “objective”, let’s define a very simple solver.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyOwnSolver</span><span class="p">(</span><span class="n">BaseSolver</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objective</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objective</span> <span class="o">=</span> <span class="n">objective</span>

    <span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">test_range</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">test_misfits</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">test_model</span> <span class="ow">in</span> <span class="n">test_range</span><span class="p">:</span>
            <span class="n">misfit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objective</span><span class="o">.</span><span class="n">misfit</span><span class="p">(</span><span class="n">test_model</span><span class="p">)</span>
            <span class="n">test_misfits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">misfit</span><span class="p">)</span>
        <span class="n">min_misfit</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">test_misfits</span><span class="p">)</span>
        <span class="n">min_index</span> <span class="o">=</span> <span class="n">test_misfits</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">min_misfit</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">test_range</span><span class="p">[</span><span class="n">min_index</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>This is totally a dumb solver, which only compare the misfit value within an unreasonably small range and return the one that has the lowest misfit. In reality, the “solve” function can be very complicated or wrap another optimisation or sampling method.</p>
</section>
<section id="example-using-myownsolver-to-solve-myownobjective">
<h2>Example: using <code class="docutils literal notranslate"><span class="pre">MyOwnSolver</span></code> to solve <code class="docutils literal notranslate"><span class="pre">MyOwnObjective</span></code><a class="headerlink" href="#example-using-myownsolver-to-solve-myownobjective" title="Permalink to this headline">#</a></h2>
<p>An example of using the classes defined above:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">objective</span> <span class="o">=</span> <span class="n">MyOwnObjective</span><span class="p">()</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">MyOwnSolver</span><span class="p">(</span><span class="n">objective</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;best fit model according to our solver:&quot;</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>best fit model according to our solver: 1
</pre></div>
</div>
</div>
</div>
</section>
<section id="under-objective-forward">
<h2>Under “objective”: “forward”<a class="headerlink" href="#under-objective-forward" title="Permalink to this headline">#</a></h2>
<p>Here we are talking about forward operators, as another possible option to define an objective.</p>
<p>Let’s take the cannon ball as an example, where there are 3 unknowns:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(m_1\)</span>, starting height above the surface</p></li>
<li><p><span class="math notranslate nohighlight">\(m_2\)</span>, initial velocity</p></li>
<li><p><span class="math notranslate nohighlight">\(m_3\)</span>, gravitational acceleration</p></li>
</ul>
<p>With <span class="math notranslate nohighlight">\(m_1\)</span>, <span class="math notranslate nohighlight">\(m_2\)</span> and <span class="math notranslate nohighlight">\(m_3\)</span>, we get the following relationship between position and time:
$<span class="math notranslate nohighlight">\( y(t) = m_1 + m_2 t - \frac{1}{2} m_3 t^2 \)</span>$</p>
<p>It’s common to use data collected from an experiment to estimate these unknown parameters. If we define this problem by subclassing “BaseObjective”:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CannonBallObjective</span><span class="p">(</span><span class="n">BaseObjective</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>

    <span class="k">def</span> <span class="nf">misfit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="n">y_predicted</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">model</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span>
        <span class="n">residual</span> <span class="o">=</span> <span class="n">y_predicted</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="k">return</span> <span class="n">residual</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">residual</span>
</pre></div>
</div>
</div>
</div>
<p>Given a forward problem, if we’d like to use least squares to calculate misfit, then the formula is always to perform a forward operation and then calculate the L2 norm of the residual vector. So I came to thinking maybe we can let users define less if they want to, and implement this pattern on our side.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># LeastSquaresObjective is included in cofi, here (below) is only some sample code</span>
<span class="c1"># from cofi.cofi_objective import LeastSquareObjective</span>
<span class="k">class</span> <span class="nc">LeastSquareObjective</span><span class="p">(</span><span class="n">BaseObjective</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">forward</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forward</span> <span class="o">=</span> <span class="n">forward</span>

    <span class="k">def</span> <span class="nf">misfit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="n">y_predicted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">residual</span> <span class="o">=</span> <span class="n">y_predicted</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="k">return</span> <span class="n">residual</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">residual</span>
</pre></div>
</div>
</div>
</div>
<p>The above <code class="docutils literal notranslate"><span class="pre">LeastSquareObjective</span></code> is also included in <code class="docutils literal notranslate"><span class="pre">cofi</span></code> so you don’t have to define it by yourself. The convenience of it is that users only need to define a forward operator in the form of either a function or a class (namely a subclass of <code class="docutils literal notranslate"><span class="pre">BaseForward</span></code> class).</p>
<p>See the following example, in which the cannon ball forward operator is defined and passed into <code class="docutils literal notranslate"><span class="pre">LeastSquareObjective</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define forward operator</span>
<span class="k">def</span> <span class="nf">cannon_ball_forward</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">model</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">model</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">t</span>

<span class="c1"># sample experiment data</span>
<span class="n">data_y</span> <span class="o">=</span> <span class="p">[</span><span class="mf">26.94</span><span class="p">,</span> <span class="mf">33.45</span><span class="p">,</span> <span class="mf">40.72</span><span class="p">,</span> <span class="mf">42.32</span><span class="p">,</span> <span class="mf">44.30</span><span class="p">,</span> <span class="mf">47.19</span><span class="p">,</span> <span class="mf">43.33</span><span class="p">,</span> <span class="mf">40.13</span><span class="p">]</span>
<span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">]</span>

<span class="c1"># instantiate objective</span>
<span class="n">cannon_ball_obj</span> <span class="o">=</span> <span class="n">LeastSquareObjective</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">data_y</span><span class="p">,</span> <span class="n">cannon_ball_forward</span><span class="p">)</span>

<span class="c1"># now cannon_ball_obj can be passed to solvers...</span>
<span class="c1"># scipy_solver = cofi.optimizers.ScipyOptimizerSolver(cannon_ball_obj)</span>
<span class="c1"># model = scipy_solver.solve()</span>
</pre></div>
</div>
</div>
</div>
<p>In the X-Ray Tomography and Receiver Function examples (in section 3 and 4), there are both “forward” class and “objective” class relating to them, and the “objective” class typically contains an instance of “forward” as a field. I’m imagining that “objective” class, as a problem statement, can contain some user defined metadata (like the pixel dimension of X-Ray Tomography problem).</p>
<p>If this “forward” idea still sounds confusing, maybe trying out the <code class="docutils literal notranslate"><span class="pre">ReceiverFunction</span></code> section 4 (in step 2) will give you a better idea.</p>
<p>When we utilise test problems from <code class="docutils literal notranslate"><span class="pre">inversion-test-suite</span></code>, implementing a forward operator and then building an objective class from it can be more convenient. And forward operators defined explicitly can also help you generate sample data, etc.</p>
<hr class="docutils" />
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="index.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Tutorials</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="2_cofi_example_linear_reg.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">2. Linear regression</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
      &copy; Copyright 2022, InLab.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>